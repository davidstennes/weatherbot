<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>WeatherBot ‚Äî Compare Two Locations</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: system-ui, sans-serif;
  margin: 0;
  padding: 16px;
  background: #f7f7f7;
}

.panel, .card, .chartWrap {
  background: #fff;
  padding: 16px;
  border-radius: 14px;
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
}

.row {
  display: grid;
  grid-template-columns: 1fr;
  gap: 10px;
}
@media (min-width: 780px) {
  .row { grid-template-columns: 1fr 1fr auto; align-items: end; }
}

input {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #ccc;
}

button {
  padding: 10px 14px;
  border-radius: 10px;
  border: none;
  background: #0077cc;
  color: white;
  font-weight: 600;
}

.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px,1fr));
  gap: 16px;
  margin-top: 14px;
}

.temp { font-size: 2rem; font-weight: 800; }
.small { font-size: .9rem; color: #666; }

.legend {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 12px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 10px;
  background: #f4f4f4;
  padding: 6px 10px;
  border-radius: 10px;
  cursor: pointer;
}

.legend-line {
  width: 60px;
  height: 0;
  border-top-width: 3px;
  border-top-style: solid;
  position: relative;
}

.legend-dot {
  position: absolute;
  top: -6px;
  left: 50%;
  transform: translateX(-50%);
  width: 10px;
  height: 10px;
  background: currentColor;
  border-radius: 50%;
}

.legend-dot.diamond {
  border-radius: 2px;
  transform: translateX(-50%) rotate(45deg);
}
</style>
</head>

<body>

<div id="mainView">
  <h2>WeatherBot</h2>

  <div class="panel">
    <div class="row">
      <input id="locA" value="Ajo">
      <input id="locB" value="Flagstaff">
      <button onclick="compare()">Compare</button>
    </div>
  </div>

  <div class="cards">
    <div class="card">
      <h3 id="aTitle"></h3>
      <div id="aToday" class="temp"></div>
    </div>
    <div class="card">
      <h3 id="bTitle"></h3>
      <div id="bToday" class="temp"></div>
    </div>
  </div>

  <button onclick="showChart()">Expand chart</button>
</div>

<div id="chartView" style="display:none;">
  <button onclick="showMain()">‚Üê Back</button>

  <div class="chartWrap">
    <h3 id="chartTitle"></h3>
    <canvas id="comboChart" height="260"></canvas>
    <div id="htmlLegend" class="legend"></div>
    <p class="small">Color = location ¬∑ Solid = high ¬∑ Dotted = low</p>
  </div>
</div>

<script>
function showChart() {
  mainView.style.display = "none";
  chartView.style.display = "block";
}
function showMain() {
  chartView.style.display = "none";
  mainView.style.display = "block";
}

async function geocode(name) {
  const r = await fetch(
    `https://geocoding-api.open-meteo.com/v1/search?name=${name}&count=1`
  );
  const j = await r.json();
  return j.results[0];
}

async function get7(lat, lon) {
  const r = await fetch(
    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}` +
    `&daily=temperature_2m_max,temperature_2m_min&temperature_unit=fahrenheit&timezone=auto`
  );
  const j = await r.json();
  return {
    days: j.daily.time.slice(0,7),
    hi: j.daily.temperature_2m_max.slice(0,7),
    lo: j.daily.temperature_2m_min.slice(0,7)
  };
}

/* HTML LEGEND PLUGIN */
const htmlLegendPlugin = {
  id: "htmlLegend",
  afterUpdate(chart, args, opts) {
    const c = document.getElementById(opts.containerID);
    c.innerHTML = "";

    chart.data.datasets.forEach((ds, i) => {
      const item = document.createElement("div");
      item.className = "legend-item";

      const line = document.createElement("div");
      line.className = "legend-line";
      line.style.borderTopColor = ds.borderColor;
      line.style.color = ds.borderColor;

      // üî¥ DOTTED for LOW
      if (ds.borderDash) line.style.borderTopStyle = "dotted";

      const dot = document.createElement("div");
      dot.className = "legend-dot";
      if (ds.pointStyle === "rectRot") dot.classList.add("diamond");

      line.appendChild(dot);

      item.appendChild(line);
      item.appendChild(document.createTextNode(ds.label));

      item.onclick = () => {
        chart.toggleDataVisibility(i);
        chart.update();
      };

      c.appendChild(item);
    });
  }
};

let chart;

function draw(labels, A, a, B, b) {
  if (chart) chart.destroy();

  chart = new Chart(comboChart, {
    type: "line",
    data: {
      labels,
      datasets: [
        { label:`${A} High`, data:a.hi, borderColor:"#1f77b4", borderWidth:3 },
        { label:`${A} Low`,  data:a.lo, borderColor:"#1f77b4", borderDash:[2,6] },
        { label:`${B} High`, data:b.hi, borderColor:"#ff7f0e", borderWidth:3, pointStyle:"rectRot" },
        { label:`${B} Low`,  data:b.lo, borderColor:"#ff7f0e", borderDash:[2,6], pointStyle:"rectRot" }
      ]
    },
    options: {
      plugins: {
        legend: { display:false },
        htmlLegend: { containerID:"htmlLegend" }
      }
    },
    plugins:[htmlLegendPlugin]
  });
}

async function compare() {
  const A = await geocode(locA.value);
  const B = await geocode(locB.value);

  aTitle.textContent = A.name;
  bTitle.textContent = B.name;

  const a = await get7(A.latitude, A.longitude);
  const b = await get7(B.latitude, B.longitude);

  aToday.textContent = `${a.hi[0]}¬∞ / ${a.lo[0]}¬∞`;
  bToday.textContent = `${b.hi[0]}¬∞ / ${b.lo[0]}¬∞`;

  chartTitle.textContent = `${A.name} vs ${B.name} ‚Äî 7-Day Forecast`;

  draw(
    a.days.map(d => new Date(d).toLocaleDateString([], {weekday:"short"})),
    A.name, a, B.name, b
  );
}

compare();
</script>

</body>
</html>
