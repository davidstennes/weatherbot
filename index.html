<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WeatherBot — Know the weather before you go</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  body { font-family: system-ui, sans-serif; margin: 0; padding: 16px; background: #f7f7f7; }
  h3 { margin: 0; }

  .panel, .card, .chartWrap {
    background: #fff; padding: 16px; border-radius: 14px;
    box-shadow: 0 2px 8px rgba(0,0,0,.08);
  }

  .row { display:grid; grid-template-columns:1fr; gap:10px; }
  @media (min-width:780px) {
    .row { grid-template-columns:1fr 1fr auto; align-items:end; }
  }

  input {
    width:100%; padding:10px; border-radius:10px;
    border:1px solid #ccc; font-size:1rem;
  }
  input::placeholder { color:#8a8a8a; font-weight:600; }

  button {
    padding:12px 14px; border-radius:10px; border:none;
    background:#0077cc; color:#fff; font-weight:700; cursor:pointer;
  }

  .brandTitle { font-size:1.5rem; font-weight:900; }
  .brandSub { font-size:.95rem; color:#444; font-weight:650; }
  .brandTag { font-size:.9rem; color:#666; }

  .fieldBlock { display:flex; flex-direction:column; gap:6px; }
  .fieldLabel { font-size:.9rem; font-weight:750; color:#333; }

  .mapsLink {
    display:none;
    margin-top:10px;
    font-weight:800;
    color:#0077cc;
    text-decoration:none;
  }
  .mapsLink:hover { text-decoration:underline; }

  .cards {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:16px;
    margin-top:14px;
  }

  .temp { font-size:1.75rem; font-weight:900; }
  .small { font-size:.9rem; color:#666; margin-top:6px; }

  .backBtn {
    background:#eef2f7; color:#123;
    border:1px solid #d6dbe3; font-weight:800;
  }
</style>
</head>

<body>

<div id="mainView">
  <div class="brand">
    <div class="brandTitle">WeatherBot</div>
    <div class="brandSub">Current conditions &amp; short-term outlook</div>
    <div class="brandTag">Know the weather before you go.</div>
  </div>

  <div class="panel">
    <div class="row" style="margin-top:10px;">
      <div class="fieldBlock">
        <div class="fieldLabel">Leaving from</div>
        <input id="locA" placeholder="City, ZIP, or landmark">
      </div>

      <div class="fieldBlock">
        <div class="fieldLabel">Going to</div>
        <input id="locB" placeholder="City, ZIP, or landmark">
      </div>

      <div>
        <button id="compareBtn" onclick="compare()">Compare</button>
      </div>
    </div>

    <!-- PURE ANCHOR: no popup risk -->
    <a id="mapsLink" class="mapsLink">
      Open route in Google Maps →
    </a>

    <div class="small">Opens in browser · use Back to return</div>
    <div id="status" class="small"></div>
  </div>

  <div class="cards">
    <div class="card">
      <h3 id="aTitle">—</h3>
      <div id="aToday" class="temp">—</div>
    </div>
    <div class="card">
      <h3 id="bTitle">—</h3>
      <div id="bToday" class="temp">—</div>
    </div>
  </div>
</div>

<script>
/* ---------- Google Maps SAFE LINK ---------- */

function updateMapsLink() {
  const a = locA.value.trim();
  const b = locB.value.trim();

  if (!a || !b) {
    mapsLink.style.display = "none";
    mapsLink.removeAttribute("href");
    return;
  }

  mapsLink.href =
    "https://www.google.com/maps/dir/?api=1"
    + "&origin=" + encodeURIComponent(a)
    + "&destination=" + encodeURIComponent(b);

  mapsLink.style.display = "inline-block";
}

locA.addEventListener("input", updateMapsLink);
locB.addEventListener("input", updateMapsLink);

/* ---------- Weather logic (unchanged core) ---------- */

async function geocode(name) {
  const r = await fetch(
    `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(name)}&count=1`
  );
  const j = await r.json();
  if (!j.results?.length) throw new Error("Location not found");
  return j.results[0];
}

async function getToday(lat, lon) {
  const r = await fetch(
    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m&temperature_unit=fahrenheit`
  );
  const j = await r.json();
  return Math.round(j.current.temperature_2m);
}

async function compare() {
  const aText = locA.value.trim();
  const bText = locB.value.trim();

  updateMapsLink();

  if (!aText || !bText) {
    status.textContent = "Enter both locations.";
    return;
  }

  status.textContent = "Loading…";

  try {
    const [A, B] = await Promise.all([
      geocode(aText),
      geocode(bText)
    ]);

    const [aTemp, bTemp] = await Promise.all([
      getToday(A.latitude, A.longitude),
      getToday(B.latitude, B.longitude)
    ]);

    aTitle.textContent = A.name;
    bTitle.textContent = B.name;
    aToday.textContent = aTemp + "°";
    bToday.textContent = bTemp + "°";

    status.textContent = "";
  } catch (e) {
    status.textContent = e.message;
  }
}
</script>

</body>
</html>
