<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>WeatherBot ‚Äî Compare Two Locations (7-Day)</title>
  <meta name="description" content="Compare 7-day highs and lows between two locations." />

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body { font-family: system-ui, sans-serif; margin: 0; padding: 16px; background: #f7f7f7; }
    h1 { margin: 0 0 6px 0; }
    p { margin: 0 0 12px 0; color: #555; }

    .panel, .card, .chartWrap {
      background: #fff;
      padding: 16px;
      border-radius: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,.08);
    }

    .row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    @media (min-width: 780px) {
      .row { grid-template-columns: 1fr 1fr auto; align-items: end; }
    }

    label { font-weight: 600; }
    input {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }

    button {
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      background: #0077cc;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }
    button:hover { opacity: .9; }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px,1fr));
      gap: 16px;
      margin-top: 14px;
    }

    .temp { font-size: 2rem; font-weight: 800; }
    .small { font-size: .9rem; color: #666; }

    .winner {
      margin-top: 14px;
      padding: 14px;
      background: #e6f3ff;
      border-radius: 12px;
      font-weight: 700;
      text-align: center;
    }

    .chartWrap { margin-top: 16px; }
    .actions { margin-top: 10px; display: flex; gap: 10px; }
  </style>
</head>

<body>

<!-- ===== MAIN VIEW ===== -->
<div id="mainView">

  <h1>WeatherBot</h1>
  <p>Compare 7-day highs and lows for any two locations.</p>

  <div class="panel">
    <div class="row">
      <div>
        <label>Location A</label>
        <input id="locA" value="San Diego">
      </div>
      <div>
        <label>Location B</label>
        <input id="locB" value="Flagstaff">
      </div>
      <div>
        <button onclick="compare()">Compare</button>
      </div>
    </div>
    <div id="status" class="small"></div>
  </div>

  <div class="cards">
    <div class="card">
      <h3 id="aTitle">‚Äî</h3>
      <div id="aEcho" class="small"></div>
      <div id="aToday" class="temp">‚Äî</div>
    </div>

    <div class="card">
      <h3 id="bTitle">‚Äî</h3>
      <div id="bEcho" class="small"></div>
      <div id="bToday" class="temp">‚Äî</div>
    </div>
  </div>

  <div id="winner" class="winner">Enter two locations.</div>

  <div class="actions">
    <button onclick="showChart()">Expand chart</button>
  </div>

</div>

<!-- ===== CHART VIEW ===== -->
<div id="chartView" style="display:none;">
  <button onclick="showMain()">‚Üê Back</button>

  <div class="chartWrap">
    <h3 id="chartTitle"></h3>
    <canvas id="comboChart" height="260"></canvas>
    <p class="small">Color = location ¬∑ Solid = high ¬∑ Dashed = low</p>
  </div>
</div>

<script>
  function showChart() {
    mainView.style.display = "none";
    chartView.style.display = "block";
  }
  function showMain() {
    chartView.style.display = "none";
    mainView.style.display = "block";
  }

  async function geocode(name) {
    const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(name)}&count=1`;
    const r = await fetch(url);
    const j = await r.json();
    if (!j.results?.length) throw new Error("Location not found");
    return j.results[0];
  }

  async function get7Day(lat, lon) {
    const url =
      `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}` +
      `&daily=temperature_2m_max,temperature_2m_min&temperature_unit=fahrenheit&timezone=auto`;
    const r = await fetch(url);
    const j = await r.json();
    return {
      days: j.daily.time.slice(0,7),
      hi: j.daily.temperature_2m_max.slice(0,7).map(Math.round),
      lo: j.daily.temperature_2m_min.slice(0,7).map(Math.round)
    };
  }

  let chart;

  function renderChart(labels, aName, aData, bName, bData) {
    if (chart) chart.destroy();

    const COLOR_A = "#1f77b4";
    const COLOR_B = "#ff7f0e";

    chart = new Chart(comboChart, {
      type: "line",
      data: {
        labels,
        datasets: [
          {
            label: `${aName} High`,
            data: aData.hi,
            borderColor: COLOR_A,
            borderWidth: 3,
            pointRadius: 3
          },
          {
            label: `${aName} Low`,
            data: aData.lo,
            borderColor: COLOR_A,
            borderDash: [8, 6],
            borderWidth: 2,
            pointRadius: 3
          },
          {
            label: `${bName} High`,
            data: bData.hi,
            borderColor: COLOR_B,
            borderWidth: 3,
            pointRadius: 3,
            pointStyle: "rectRot"
          },
          {
            label: `${bName} Low`,
            data: bData.lo,
            borderColor: COLOR_B,
            borderDash: [8, 6],
            borderWidth: 2,
            pointRadius: 3,
            pointStyle: "rectRot"
          }
        ]
      },
      options: {
        interaction: { mode:"index", intersect:false },
        plugins: {
          legend: {
            position: "bottom",
            labels: {
              usePointStyle: true,
              pointStyle: "line",
              useLineStyle: true,
              boxWidth: 50   // long enough to show dashed lows
            }
          }
        },
        scales: {
          y: { title:{ display:true, text:"¬∞F" } }
        }
      }
    });
  }

  async function compare() {
    status.textContent = "Loading‚Ä¶";

    try {
      const [A, B] = await Promise.all([
        geocode(locA.value),
        geocode(locB.value)
      ]);

      aTitle.textContent = A.name;
      bTitle.textContent = B.name;
      aEcho.textContent = `${A.admin1||""} ${A.country} (${A.latitude.toFixed(3)}, ${A.longitude.toFixed(3)})`;
      bEcho.textContent = `${B.admin1||""} ${B.country} (${B.latitude.toFixed(3)}, ${B.longitude.toFixed(3)})`;

      const [aData, bData] = await Promise.all([
        get7Day(A.latitude, A.longitude),
        get7Day(B.latitude, B.longitude)
      ]);

      aToday.textContent = `${aData.hi[0]}¬∞ / ${aData.lo[0]}¬∞`;
      bToday.textContent = `${bData.hi[0]}¬∞ / ${bData.lo[0]}¬∞`;

      const labels = aData.days.map(d =>
        new Date(d).toLocaleDateString([], { weekday:"short" })
      );

      chartTitle.textContent = `${A.name} vs ${B.name} ‚Äî 7-Day Forecast`;
      renderChart(labels, A.name, aData, B.name, bData);

      const avgA = (aData.hi.reduce((a,b)=>a+b)+aData.lo.reduce((a,b)=>a+b))/(aData.hi.length*2);
      const avgB = (bData.hi.reduce((a,b)=>a+b)+bData.lo.reduce((a,b)=>a+b))/(bData.hi.length*2);

      winner.textContent =
        avgA > avgB ? `Better weather this week: ${A.name}` :
        avgB > avgA ? `Better weather this week: ${B.name}` :
        "It‚Äôs basically a tie ü§∑";

      status.textContent = "";
    } catch (e) {
      status.textContent = e.message;
    }
  }

  compare();
</script>

</body>
</html>
