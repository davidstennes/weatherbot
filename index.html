<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>WeatherBot â€” San Diego vs Flagstaff (7-Day High/Low)</title>
  <meta name="description"
        content="Compare a 7-day forecast (daily highs and lows) for San Diego and Flagstaff with simple charts." />

  <!-- Chart.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 16px;
      background: #f7f7f7;
      color: #111;
    }

    h1 {
      font-size: 1.35rem;
      margin: 0 0 6px 0;
    }

    p {
      margin: 0 0 14px 0;
      color: #555;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
      margin-top: 12px;
    }

    .card {
      background: #fff;
      padding: 16px;
      border-radius: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,.08);
    }

    .card h2 {
      margin: 0 0 6px 0;
      font-size: 1.15rem;
    }

    .subtext {
      font-size: 1.15em;
      font-weight: 600;
      color: #666;
      margin-bottom: 10px;
      line-height: 1.25;
    }

    .temp {
      font-size: 2rem;
      font-weight: 750;
      margin-bottom: 4px;
    }

    .label {
      font-size: 0.85rem;
      color: #666;
    }

    .winner {
      margin-top: 18px;
      padding: 14px;
      background: #e6f3ff;
      border-radius: 12px;
      font-weight: 650;
      text-align: center;
    }

    .charts {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      margin-top: 16px;
    }

    .chartWrap {
      background: #fff;
      padding: 14px;
      border-radius: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,.08);
    }

    .chartTitle {
      font-weight: 700;
      margin: 0 0 8px 0;
      color: #222;
    }

    .smallNote {
      font-size: 0.8rem;
      color: #777;
      margin-top: 8px;
    }

    footer {
      margin-top: 22px;
      font-size: 0.75rem;
      color: #888;
      text-align: center;
    }

    button {
      padding: 10px 14px;
      border-radius: 10px;
      border: 0;
      font-weight: 650;
      cursor: pointer;
    }

    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <h1>WeatherBot â€” 7-Day High/Low</h1>
  <p>San Diego vs Flagstaff. Fast, simple, no drama.</p>

  <div class="cards">
    <div class="card">
      <h2>San Diego</h2>
      <div class="subtext">At Chuze Fitness â€” where Sandi dares to tread</div>
      <div id="sdToday" class="temp">Loadingâ€¦</div>
      <div class="label">Today high / low (Â°F)</div>
    </div>

    <div class="card">
      <h2>Flagstaff</h2>
      <div id="fsToday" class="temp">Loadingâ€¦</div>
      <div class="label">Today high / low (Â°F)</div>
    </div>
  </div>

  <div id="winner" class="winner">Loading the 7-day matchupâ€¦</div>

  <div class="charts">
    <div class="chartWrap">
      <div class="chartTitle">7-Day Highs (Â°F)</div>
      <canvas id="hiChart" height="140"></canvas>
      <div class="smallNote">Tip: tap/hover points for exact values.</div>
    </div>

    <div class="chartWrap">
      <div class="chartTitle">7-Day Lows (Â°F)</div>
      <canvas id="loChart" height="140"></canvas>
    </div>
  </div>

  <footer>WeatherBot â€” dabble mode</footer>

<script>
  // --- Locations (fixed for now) ---
  const SD = { name: "San Diego", lat: 32.7157, lon: -117.1611 };
  const FS = { name: "Flagstaff", lat: 35.20, lon: -111.65 };

  // --- Fetch 7-day daily highs/lows ---
  async function get7Day(lat, lon) {
    const url =
      `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}` +
      `&daily=temperature_2m_max,temperature_2m_min` +
      `&temperature_unit=fahrenheit&timezone=auto`;

    const res = await fetch(url);
    if (!res.ok) throw new Error("Weather API error");

    const data = await res.json();
    const days = data.daily.time.slice(0, 7);

    const hi = data.daily.temperature_2m_max.slice(0, 7).map(v => Math.round(v));
    const lo = data.daily.temperature_2m_min.slice(0, 7).map(v => Math.round(v));

    return { days, hi, lo };
  }

  function formatDayLabel(isoDate) {
    const d = new Date(isoDate + "T00:00:00");
    return d.toLocaleDateString([], { weekday: "short" });
  }

  // --- Charts ---
  let hiChart, loChart;

  function renderLineChart(canvasId, labels, aData, bData, aName, bName, yTitle) {
    const ctx = document.getElementById(canvasId).getContext("2d");

    // destroy if re-render
    if (canvasId === "hiChart" && hiChart) hiChart.destroy();
    if (canvasId === "loChart" && loChart) loChart.destroy();

    const chart = new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [
          { label: aName, data: aData, tension: 0.25 },
          { label: bName, data: bData, tension: 0.25 }
        ]
      },
      options: {
        responsive: true,
        interaction: { mode: "index", intersect: false },
        plugins: {
          legend: { position: "bottom" }
        },
        scales: {
          y: { title: { display: true, text: yTitle } }
        }
      }
    });

    if (canvasId === "hiChart") hiChart = chart;
    if (canvasId === "loChart") loChart = chart;
  }

  function setToday(elId, hi, lo) {
    document.getElementById(elId).textContent = `${hi}Â° / ${lo}Â°`;
  }

  function decideWinner(sd, fs) {
    // Simple heuristic: higher average temp wins (hi+lo)/2 averaged over 7 days
    const avg = (arr) => arr.reduce((a,b)=>a+b,0) / arr.length;
    const sdAvg = (avg(sd.hi) + avg(sd.lo)) / 2;
    const fsAvg = (avg(fs.hi) + avg(fs.lo)) / 2;

    if (sdAvg > fsAvg) return `${SD.name} wins (warmer overall this week).`;
    if (fsAvg > sdAvg) return `${FS.name} wins (warmer overall this week).`;
    return "Itâ€™s basically a tie this week ðŸ¤·";
  }

  (async () => {
    try {
      const [sd, fs] = await Promise.all([
        get7Day(SD.lat, SD.lon),
        get7Day(FS.lat, FS.lon)
      ]);

      // Today card values (day 0)
      setToday("sdToday", sd.hi[0], sd.lo[0]);
      setToday("fsToday", fs.hi[0], fs.lo[0]);

      // Labels
      const labels = sd.days.map(formatDayLabel);

      // Charts
      renderLineChart("hiChart", labels, sd.hi, fs.hi, SD.name, FS.name, "High (Â°F)");
      renderLineChart("loChart", labels, sd.lo, fs.lo, SD.name, FS.name, "Low (Â°F)");

      // Winner text
      document.getElementById("winner").textContent = decideWinner(sd, fs);

    } catch (err) {
      console.error(err);
      document.getElementById("winner").textContent =
        "Couldnâ€™t load the forecast. (Usually a temporary API hiccup or connection issue.)";
      document.getElementById("sdToday").textContent = "Error";
      document.getElementById("fsToday").textContent = "Error";
    }
  })();
</script>

</body>
</html>
