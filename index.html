<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WeatherBot</title>

  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background:#fff;color:#111;
    }

    /* HERO */
    .wb-hero{padding:1.6rem 1rem 1.1rem;text-align:center;}
    .wb-hero-row{display:flex;align-items:center;justify-content:center;gap:.75rem;}
    .wb-title{margin:0;font-size:clamp(1.65rem,5.2vw,2.15rem);font-weight:600;line-height:1.18;max-width:22rem;}
    .wb-icon{font-size:1.45rem;opacity:.8;user-select:none;}
    .wb-left{transform:translateY(.08em);} .wb-right{transform:translateY(.04em);}
    .wb-subtitle{margin-top:.45rem;font-size:.95rem;opacity:.72;}

    .status{ text-align:center; margin-top:-0.65rem; font-size:0.9rem; opacity:0.65; min-height:1.25rem; padding:0 1rem; }

    /* LAYOUT */
    .compare-wrap{
      display:flex;
      flex-direction:column;
      gap:1rem;
      padding: 1.1rem 1rem 2rem;
      align-items:center;
    }

    .row{
      display:flex;
      gap:0.75rem;
      justify-content:center;
      align-items:flex-start;
      width:100%;
      max-width: 520px;
    }

    /* CARD BASE */
    .card{
      border:2px solid #e0e0e0;
      border-radius:18px;
      background:#fff;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      color:#555;
    }

    /* CITY CARD */
    .city-card{
      width: 150px;
      min-height: 92px;
      padding: 0.5rem 0.6rem 0.55rem;
      position:relative;
      justify-content:center;
      gap:0.15rem;
    }

    .city-input{
      width:100%;
      border:0;
      outline:none;
      font-size:16px; /* prevent zoom */
      font-weight:600;
      text-align:left;
      padding: 0.35rem 0.5rem;
      border-radius:14px;
      background: transparent;
      color:#111;
    }

    .city-input::placeholder{ color:#777; font-weight:600; }

    .city-subline{
      width:100%;
      text-align:left;
      font-size: 12px;
      opacity: 0.65;
      padding: 0 0.55rem;
      min-height: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Suggestions dropdown */
    .suggestions{
      position:absolute;
      left:0; right:0;
      top: 100%;
      margin-top: 8px;
      width: 320px;
      max-width: calc(100vw - 2rem);
      border:1px solid #e6e6e6;
      border-radius:14px;
      background:#fff;
      box-shadow:0 10px 30px rgba(0,0,0,0.08);
      overflow:hidden;
      display:none;
      z-index:50;
    }

    .suggestions button{
      width:100%;
      border:0;
      background:#fff;
      padding:0.65rem 0.75rem;
      text-align:left;
      font-size:15px;
      color:#111;
    }
    .suggestions button:active{ background:#f5f5f5; }
    .suggestions .sub{ display:block; font-size:12px; opacity:.65; margin-top:2px; }

    /* DAY CARDS */
    .day-card{
      width: 90px;
      height: 165px;
      padding: 0.6rem 0.5rem 0.5rem;
      gap: 0.35rem;
      align-items:center;
    }
    .dow{font-weight:600;color:#777;margin-top:0.1rem;}
    .temps{margin-top:0.65rem;display:flex;flex-direction:column;align-items:center;gap:0.25rem;color:#111;}
    .hi{font-size:1.35rem;font-weight:700;line-height:1;}
    .lo{font-size:1.05rem;font-weight:600;opacity:.55;line-height:1;}

    @media (max-width: 360px){
      .city-card{ width: 140px; }
      .day-card{ width: 84px; }
    }
  </style>
</head>

<body>

  <header class="wb-hero">
    <div class="wb-hero-row">
      <span class="wb-icon wb-left" aria-hidden="true">üå¥</span>
      <h1 class="wb-title">Where is the weather better?</h1>
      <span class="wb-icon wb-right" aria-hidden="true">‚õ∑Ô∏è</span>
    </div>
    <div class="wb-subtitle">Compare up to five places side by side.</div>
  </header>

  <div id="status" class="status"></div>

  <main class="compare-wrap">

    <!-- ROW A -->
    <section class="row" aria-label="City A">
      <div class="card city-card">
        <input id="cityInputA" class="city-input" type="text" placeholder="Add city" autocomplete="off" />
        <div id="citySubA" class="city-subline"></div>
        <div id="suggestionsA" class="suggestions" role="listbox" aria-label="City A suggestions"></div>
      </div>

      <div class="card day-card">
        <div class="dow" id="dowA0">‚Äî</div>
        <div class="temps">
          <div class="hi" id="hiA0">‚Äî</div>
          <div class="lo" id="loA0">‚Äî</div>
        </div>
      </div>

      <div class="card day-card">
        <div class="dow" id="dowA1">‚Äî</div>
        <div class="temps">
          <div class="hi" id="hiA1">‚Äî</div>
          <div class="lo" id="loA1">‚Äî</div>
        </div>
      </div>

      <div class="card day-card">
        <div class="dow" id="dowA2">‚Äî</div>
        <div class="temps">
          <div class="hi" id="hiA2">‚Äî</div>
          <div class="lo" id="loA2">‚Äî</div>
        </div>
      </div>
    </section>

    <!-- ROW B -->
    <section class="row" aria-label="City B">
      <div class="card city-card">
        <input id="cityInputB" class="city-input" type="text" placeholder="Add city" autocomplete="off" />
        <div id="citySubB" class="city-subline"></div>
        <div id="suggestionsB" class="suggestions" role="listbox" aria-label="City B suggestions"></div>
      </div>

      <div class="card day-card">
        <div class="dow" id="dowB0">‚Äî</div>
        <div class="temps">
          <div class="hi" id="hiB0">‚Äî</div>
          <div class="lo" id="loB0">‚Äî</div>
        </div>
      </div>

      <div class="card day-card">
        <div class="dow" id="dowB1">‚Äî</div>
        <div class="temps">
          <div class="hi" id="hiB1">‚Äî</div>
          <div class="lo" id="loB1">‚Äî</div>
        </div>
      </div>

      <div class="card day-card">
        <div class="dow" id="dowB2">‚Äî</div>
        <div class="temps">
          <div class="hi" id="hiB2">‚Äî</div>
          <div class="lo" id="loB2">‚Äî</div>
        </div>
      </div>
    </section>

  </main>

  <script>
    const statusEl = document.getElementById("status");
    function setStatus(msg){ statusEl.textContent = msg || ""; }

    function fmtWeekday(dateStr){
      const d = new Date(dateStr + "T12:00:00");
      return new Intl.DateTimeFormat(undefined,{weekday:"short"}).format(d);
    }
    function fmtTempF(n){
      if(n===null||n===undefined||Number.isNaN(n)) return "‚Äî";
      return Math.round(n) + "¬∞";
    }

    async function geocodeCities(query){
      const url = new URL("https://geocoding-api.open-meteo.com/v1/search");
      url.searchParams.set("name", query);
      url.searchParams.set("count", "8");
      url.searchParams.set("language", "en");
      url.searchParams.set("format", "json");
      const res = await fetch(url.toString());
      if(!res.ok) throw new Error("Geocoding failed");
      const data = await res.json();
      return data.results || [];
    }

    async function fetch3DayForecastF(lat, lon){
      const url = new URL("https://api.open-meteo.com/v1/forecast");
      url.searchParams.set("latitude", lat);
      url.searchParams.set("longitude", lon);
      url.searchParams.set("daily", "temperature_2m_max,temperature_2m_min");
      url.searchParams.set("temperature_unit", "fahrenheit"); // ‚úÖ Fahrenheit
      url.searchParams.set("timezone", "auto");
      const res = await fetch(url.toString());
      if(!res.ok) throw new Error("Forecast failed");
      return await res.json();
    }

    function clearRow(prefix){
      for(let i=0;i<3;i++){
        document.getElementById(`dow${prefix}${i}`).textContent = "‚Äî";
        document.getElementById(`hi${prefix}${i}`).textContent = "‚Äî";
        document.getElementById(`lo${prefix}${i}`).textContent = "‚Äî";
      }
    }

    function initDows(prefix){
      const now = new Date();
      for(let i=0;i<3;i++){
        const d = new Date(now);
        d.setDate(now.getDate()+i);
        const dow = new Intl.DateTimeFormat(undefined,{weekday:"short"}).format(d);
        document.getElementById(`dow${prefix}${i}`).textContent = dow;
      }
    }

    function fillFromForecast(prefix, forecast){
      const daily = forecast.daily;
      if(!daily || !daily.time || daily.time.length < 3) throw new Error("Not enough daily data");
      for(let i=0;i<3;i++){
        const dateStr = daily.time[i];
        document.getElementById(`dow${prefix}${i}`).textContent = fmtWeekday(dateStr);
        document.getElementById(`hi${prefix}${i}`).textContent = fmtTempF(daily.temperature_2m_max[i]);
        document.getElementById(`lo${prefix}${i}`).textContent = fmtTempF(daily.temperature_2m_min[i]);
      }
    }

    function formatSubline(city){
      // small line = City, State (admin1) (fallbacks)
      const state = city.admin1 || city.admin2 || city.admin3 || "";
      const country = city.country || "";
      if(state) return `${city.name}, ${state}`;
      if(country) return `${city.name}, ${country}`;
      return city.name;
    }

    function bindCityRow({
      inputId, subId, suggestionsId, prefix
    }){
      const input = document.getElementById(inputId);
      const subline = document.getElementById(subId);
      const sugg = document.getElementById(suggestionsId);

      let debounceTimer = null;
      let activeResults = [];
      let lastQuery = "";

      function showSuggestions(show){
        sugg.style.display = show ? "block" : "none";
      }

      function renderSuggestions(results){
        sugg.innerHTML = "";
        if(!results.length){ showSuggestions(false); return; }

        results.slice(0,8).forEach(r=>{
          const btn = document.createElement("button");
          btn.type = "button";
          btn.setAttribute("role","option");

          const primary = `${r.name}${r.admin1 ? ", " + r.admin1 : ""}${r.country ? ", " + r.country : ""}`;
          const secondary = `(${r.latitude.toFixed(3)}, ${r.longitude.toFixed(3)})`;
          btn.innerHTML = `${primary}<span class="sub">${secondary}</span>`;

          btn.addEventListener("click", ()=> selectCity(r));
          sugg.appendChild(btn);
        });

        showSuggestions(true);
      }

      async function selectCity(city){
        // Put JUST city name in box
        input.value = city.name;

        // Under it: City, State (admin1)
        subline.textContent = formatSubline(city);

        showSuggestions(false);
        activeResults = [];

        setStatus("Loading forecast‚Ä¶");
        clearRow(prefix);

        try{
          const forecast = await fetch3DayForecastF(city.latitude, city.longitude);
          fillFromForecast(prefix, forecast);
          setStatus("");
        }catch(e){
          console.error(e);
          setStatus("Couldn‚Äôt load forecast for that city.");
        }
      }

      // Outside tap closes dropdown (per row)
      document.addEventListener("click", (e)=>{
        const within = (e.target === input) || sugg.contains(e.target);
        if(!within) showSuggestions(false);
      });

      input.addEventListener("input", ()=>{
        const q = input.value.trim();
        // Clear subline while typing if they change city name
        if(q.length === 0) subline.textContent = "";

        if(q.length < 2){
          showSuggestions(false);
          setStatus("");
          return;
        }
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(async ()=>{
          try{
            lastQuery = q;
            const results = await geocodeCities(q);

            // ignore stale return
            if(input.value.trim() !== lastQuery) return;

            activeResults = results;
            renderSuggestions(results);
          }catch(e){
            console.error(e);
            showSuggestions(false);
            setStatus("Autocomplete unavailable.");
          }
        }, 250);
      });

      input.addEventListener("keydown", (e)=>{
        if(e.key === "Enter" && activeResults.length){
          e.preventDefault();
          // Choose first result on Enter
          const city = activeResults[0];
          input.value = city.name;
          subline.textContent = formatSubline(city);
          showSuggestions(false);
          selectCity(city);
        }
        if(e.key === "Escape"){
          showSuggestions(false);
        }
      });

      // init weekday labels (forecast will overwrite when chosen)
      initDows(prefix);
    }

    // Bind both rows
    bindCityRow({ inputId:"cityInputA", subId:"citySubA", suggestionsId:"suggestionsA", prefix:"A" });
    bindCityRow({ inputId:"cityInputB", subId:"citySubB", suggestionsId:"suggestionsB", prefix:"B" });
  </script>

</body>
</html>
